<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>EMDR Tool with Binaural Tactile Sounds</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap');
  @import url('https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@700&display=swap');

  body { 
    font-family: Arial, sans-serif; 
    text-align: center; 
    background: #e0f7f7; 
    color:#111; 
    margin:0; 
    padding-bottom:60px; 
    border-top:10px solid #004d4d; 
    border-left:10px solid #004d4d; 
    border-right:10px solid #004d4d; 
    border-bottom:60px solid #004d4d; 
    box-shadow: 0 6px 20px rgba(0,77,77,0.4);
  }

  h1 { 
    margin-top: 18px; 
    display:inline-block; 
    padding:6px 16px; 
    border-radius:12px; 
    background:#fff; 
    font-family: 'Roboto Slab', serif;
    font-weight: 700;
    font-size: 32px;
    color: #004d4d;
    text-shadow: 1px 1px 2px #66cccc, -1px -1px 2px #66cccc;
    box-shadow: 0 4px 12px rgba(0,77,77,0.4);
  }

  .controls { margin: 14px auto; max-width: 980px; }
  .row { display: flex; gap: 12px; align-items: center; justify-content: center; flex-wrap: wrap; }
  label { font-size: 14px; }

  canvas { 
    background: #fff; 
    display: block; 
    margin: 18px auto; 
    border-radius: 12px; 
    border: 3px solid #004d4d; 
    box-shadow: 0 6px 18px rgba(0, 77, 77, 0.5); 
  }

  button { 
    padding: 8px 14px; 
    font-size: 14px; 
    cursor: pointer; 
    background:#004d4d; 
    color:#fff; 
    border:2px solid #003333; 
    border-radius:12px; 
    box-shadow: 0 3px 8px rgba(0,0,0,0.3);
  }

  button:hover { 
    background:#003333; 
    border-color:#002222;
  }

  .small { font-size: 13px; color: #333; }
  input[type="range"] { 
    vertical-align: middle; 
    accent-color: #ffffff;
    background: #ffffff;
    box-shadow: 0 3px 8px rgba(0,77,77,0.3);
  }

  select { 
    vertical-align: middle; 
    padding: 4px 8px; 
    border-radius: 12px; 
    border: 2px solid #004d4d; 
    background: #ffffff; 
    font-size:14px;
    box-shadow: 0 3px 8px rgba(0,77,77,0.3);
  }

  .signature { 
    position:fixed; 
    bottom:8px; 
    right:12px; 
    font-family: 'Great Vibes', cursive;
    font-size:18px; 
    color:#ffffff; 
    text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
  }

  .signature-left { 
    position:fixed; 
    bottom:8px; 
    left:12px; 
    font-family: 'Great Vibes', cursive;
    font-size:18px; 
    color:#ffffff; 
    text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
  }

  .copyright { 
    position:fixed; 
    bottom:8px; 
    left:50%; 
    transform:translateX(-50%); 
    font-size:12px; 
    color:#004d4d; 
    text-shadow: 1px 1px 2px rgba(0,77,77,0.4);
  }

  .copyright a { 
    color:#004d4d; 
    text-decoration:none; 
  }

  .copyright a:hover { 
    text-decoration:underline; 
  }
</style>
</head>
<body>
  <h1>EMDR</h1>

  <div class="controls">
    <div class="row">
      <label>Speed:
        <input id="speedSlider" type="range" min="0.5" max="12" step="0.1" value="2">
      </label>
      <span class="small"><strong id="speedDisplay">2.0</strong> px/frame</span>

      <label>Dot Size:
        <input id="sizeSlider" type="range" min="10" max="60" step="1" value="20">
      </label>

      <label>Cycles (per set):
        <input id="cycles" type="number" min="1" value="5" style="width:70px">
      </label>

      <label>Edge hits (this set): <span id="edgeHits">0</span></label>
      <label>Sets done: <span id="sets">0</span></label>

      <label>Colour:
        <input id="color" type="color" value="#66cccc">
      </label>

      <label>Shape:
        <select id="shape">
          <option value="circle">Circle</option>
          <option value="bar">Bar</option>
          <option value="diamond">Diamond</option>
          <option value="star">Star</option>
          <option value="cat">Cat Face</option>
        </select>
      </label>

      <label>Sound:
        <select id="soundSelect">
          <option value="ding">Soft Ding</option>
          <option value="knock">Wooden Knock</option>
          <option value="chime">Calm Chime</option>
          <option value="tap">Muted Tap</option>
        </select>
      </label>

      <label>Tactile:
        <input id="tactile" type="checkbox">
      </label>

      <button id="startBtn">Start</button>
      <button id="fullscreenBtn">Fullscreen</button>
      <button id="soundOnlyBtn">Sound Only</button>
    </div>
  </div>

  <canvas id="emdrCanvas" width="800" height="220"></canvas>

  <div class="signature">Created by B3oudy</div>
  <div class="signature-left">Dr Mohammed</div>
  <div class="copyright"><a href="#">Â© All rights reserved</a></div>

<script>
/* === SAME SCRIPT AS BEFORE (unchanged) === */
const canvas = document.getElementById('emdrCanvas');
const ctx = canvas.getContext('2d');

const startBtn = document.getElementById('startBtn');
const fullscreenBtn = document.getElementById('fullscreenBtn');
const soundOnlyBtn = document.getElementById('soundOnlyBtn');

const speedSlider = document.getElementById('speedSlider');
const speedDisplay = document.getElementById('speedDisplay');
const sizeSlider = document.getElementById('sizeSlider');
const cyclesInput = document.getElementById('cycles');
const edgeHitsDisplay = document.getElementById('edgeHits');
const setsDisplay = document.getElementById('sets');
const colorInput = document.getElementById('color');
const shapeInput = document.getElementById('shape');
const tactileToggle = document.getElementById('tactile');
const soundSelect = document.getElementById('soundSelect');

/* === Audio === */
let audioCtx = null;
const toneFrequencies = { ding: 880, knock: 440, chime: 660, tap: 550 };
let audioBuffers = {};

function createToneBuffer(freq, duration = 0.12) {
  const sampleRate = 44100;
  const length = Math.floor(sampleRate * duration);
  const buffer = audioCtx.createBuffer(1, length, sampleRate);
  const data = buffer.getChannelData(0);
  for (let i = 0; i < length; i++) {
    data[i] = Math.sin(2 * Math.PI * freq * i / sampleRate) * Math.exp(-3 * i / length);
  }
  return buffer;
}
async function initAudio() {
  if (audioCtx) return;
  audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  for (const [key, freq] of Object.entries(toneFrequencies)) {
    audioBuffers[key] = createToneBuffer(freq);
  }
}
async function playSound(soundKey, pan = 0) {
  try {
    if (!audioCtx) await initAudio();
    if (audioCtx.state === 'suspended') await audioCtx.resume();
    const buffer = audioBuffers[soundKey];
    if (!buffer) return;
    const src = audioCtx.createBufferSource();
    src.buffer = buffer;
    try {
      const p = audioCtx.createStereoPanner();
      p.pan.value = pan;
      src.connect(p).connect(audioCtx.destination);
    } catch (e) { src.connect(audioCtx.destination); }
    src.start(0);
  } catch (e) {}
}

/* === Animation state === */
let unit = parseInt(sizeSlider.value, 10);
let x = unit;
let dir = 1;
let animating = false;
let animationId = null;
let edgeHits = 0;
let sets = 0;
let totalCycles = parseInt(cyclesInput.value, 10) || 1;
let soundOnlyMode = false;

/* === Helpers === */
function halfWidthForShape(shape) { return shape==='bar'?unit*2:unit; }
function drawShape(shape, cx, cy, color) {
  ctx.fillStyle = color;
  ctx.strokeStyle = color;
  if(shape==='circle'){ctx.beginPath();ctx.arc(cx,cy,unit,0,Math.PI*2);ctx.fill();return;}
  if(shape==='bar'){ctx.fillRect(cx-unit*2,cy-unit*0.9,unit*4,unit*1.8);return;}
  if(shape==='diamond'){ctx.beginPath();ctx.moveTo(cx,cy-unit);ctx.lineTo(cx+unit,cy);ctx.lineTo(cx,cy+unit);ctx.lineTo(cx-unit,cy);ctx.closePath();ctx.fill();return;}
  if(shape==='star'){const spikes=5,outer=unit,inner=unit*0.5;let rot=Math.PI/2*3,step=Math.PI/spikes;ctx.beginPath();ctx.moveTo(cx,cy-outer);for(let i=0;i<spikes;i++){ctx.lineTo(cx+Math.cos(rot)*outer,cy+Math.sin(rot)*outer);rot+=step;ctx.lineTo(cx+Math.cos(rot)*inner,cy+Math.sin(rot)*inner);rot+=step;}ctx.closePath();ctx.fill();return;}
  if(shape==='cat'){ctx.beginPath();ctx.arc(cx,cy,unit,0,Math.PI*2);ctx.fill();ctx.beginPath();ctx.moveTo(cx-unit*0.6,cy-unit*0.8);ctx.lineTo(cx-unit*1.1,cy-unit*1.6);ctx.lineTo(cx-unit*0.2,cy-unit*1.0);ctx.closePath();ctx.fill();ctx.beginPath();ctx.moveTo(cx+unit*0.6,cy-unit*0.8);ctx.lineTo(cx+unit*1.1,cy-unit*1.6);ctx.lineTo(cx+unit*0.2,cy-unit*1.0);ctx.closePath();ctx.fill();}
}
function onEdgeHit(side) {
  if (tactileToggle.checked || soundOnlyMode) playSound(soundSelect.value, side==='left'?-1:1);
  edgeHits++; edgeHitsDisplay.textContent=edgeHits;
  if(edgeHits>=totalCycles){sets++;setsDisplay.textContent=sets;edgeHits=0;edgeHitsDisplay.textContent=edgeHits;}
}

/* === Animation loop === */
function animate(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  const shape=shapeInput.value;
  const halfW=halfWidthForShape(shape);
  const leftBound=halfW;
  const rightBound=canvas.width-halfW;
  if(!soundOnlyMode) drawShape(shape,x,canvas.height/2,colorInput.value);
  const speed=parseFloat(speedSlider.value);
  x+=dir*speed;
  if(x>=rightBound){x=rightBound;if(dir>0){dir=-1;onEdgeHit('right');}}
  else if(x<=leftBound){x=leftBound;if(dir<0){dir=1;onEdgeHit('left');}}
  animationId=requestAnimationFrame(animate);
}

/* === Start/Stop === */
function startAnimation(){if(animating)return;totalCycles=parseInt(cyclesInput.value,10)||1;unit=parseInt(sizeSlider.value,10);edgeHits=0;edgeHitsDisplay.textContent=edgeHits;x=halfWidthForShape(shapeInput.value);dir=1;animating=true;startBtn.textContent="Stop";initAudio().catch(()=>{});animate();}
function stopAnimation(){if(!animating)return;cancelAnimationFrame(animationId);animating=false;startBtn.textContent="Start";}

/* === Fullscreen === */
const DEFAULT_W=800,DEFAULT_H=220;
function enterFullscreen(el){(el.requestFullscreen||el.webkitRequestFullscreen||el.mozRequestFullScreen||el.msRequestFullscreen).call(el);}
function exitFullscreen(){(document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen).call(document);}
function resizeCanvasForFullscreen(active){if(active){const dpr=window.devicePixelRatio||1;canvas.style.width='100vw';canvas.style.height='100vh';canvas.width=Math.floor(window.innerWidth*dpr);canvas.height=Math.floor(window.innerHeight*dpr);}else{canvas.style.width='';canvas.style.height='';canvas.width=DEFAULT_W;canvas.height=DEFAULT_H;}}
function isCanvasFullscreen(){return document.fullscreenElement===canvas||document.webkitFullscreenElement===canvas||document.mozFullScreenElement===canvas||document.msFullscreenElement===canvas;}
fullscreenBtn.addEventListener('click',()=>{if(!isCanvasFullscreen()){enterFullscreen(canvas);}else{exitFullscreen();}});
document.addEventListener('fullscreenchange',()=>{const active=isCanvasFullscreen();resizeCanvasForFullscreen(active);fullscreenBtn.textContent=active?'Exit Fullscreen':'Fullscreen';});
document.addEventListener('webkitfullscreenchange',()=>{const active=isCanvasFullscreen();resizeCanvasForFullscreen(active);fullscreenBtn.textContent=active?'Exit Fullscreen':'Fullscreen';});
window.addEventListener('resize',()=>{if(isCanvasFullscreen()) resizeCanvasForFullscreen(true);});

/* === Events === */
startBtn.addEventListener('click',()=>{if(!animating)startAnimation();else stopAnimation();});
speedSlider.addEventListener('input',()=>{speedDisplay.textContent=parseFloat(speedSlider.value).toFixed(1);});
sizeSlider.addEventListener('input',()=>{unit=parseInt(sizeSlider.value,10);});
soundOnlyBtn.addEventListener('click',()=>{soundOnlyMode=!soundOnlyMode;soundOnlyBtn.textContent=soundOnlyMode?"Visual + Sound":"Sound Only";});

/* === Init displays === */
speedDisplay.textContent=parseFloat(speedSlider.value).toFixed(1);
setsDisplay.textContent=sets.toString();
edgeHitsDisplay.textContent=edgeHits.toString();
</script>
</body>
</html>
